^ productRule @article/d:rule-of-product
^ sumRule @article/combinatorics/rules/sum/d:rule-of-sum

@task
    title: Сегодня убираешься ты
    statement: |
        Из двух старших классов, насчитывающих по $30$ учеников каждый, надо выделить по одному ученику для помощи в уборке столовой.
        Сколькими способами может быть сделан этот выбор?
    solution: |
        Ученика из первого из двух классов можно выбрать $30$ разными способами.
        Вне зависимости от сделанного выбора, второго ученика из второго класса тоже можно выбрать $30$-ю способами.
        По [правилу умножения](^productRule) получаем всего $30 \cdot 30 = 900$ способов выбрать пару учеников для уборки в столовой.
    answer: |
        $900$

@task
    title: Небольшая поездка
    statement: |
        Из города $A$ в город $B$ ведут $7$ дорог, а из $B$ в $C$ -- $10$.
        Сколько есть путей из города $A$ в город $C$, которые проходят через $B$.
    solution: |
        Сначала выбираем одну из $7$ дорог в $B$.
        Вне зависимости от сделанного выбора, после этого можно выбрать одну из $10$ дорог в $C$.
        По [правилу умножения](^productRule) получаем всего $7 \cdot 10 = 70$ возможных путей.
    answer: |
        $70$

@task
    title: Волшебных дел мастер
    statement: |
        В волшебной мастерской делают посохи для колдунов.
        Есть $6$ видов древесины, из которых может быть изготовлен посох.
        Затем незаряженный посох можно напитать силой одной из $4$-х стихий.
        Сколько разных видов посохов может изготовить эта мастерская?
    solution: |
        По [правилу умножения](^productRule) получаем $6 \cdot 4 = 24$ вида посохов.
    answer: |
        $24$

@task
    title: Читай по буквам
    statement: |
        Сколькими способами можно выбрать согласную и гласную буквы из слова "редактор"?
        А из слова "преступление"?
    solution: |
        В слове "редактор" есть $5$ согласных и $3$ гласные.
        По [правилу умножения](^productRule) получается $5 \cdot 3 = 15$ способов выбрать согласную и гласную буквы.

        В слове "преступление" $7$ согласных, но только $6$ разных. Также $5$ гласных, $3$ из которых разные.
        Мы не можем использовать повторящиеся буквы, так как они дадут повторяющиеся пары букв.
        Поэтому используем только уникальные буквы: $ 6 \cdot 3 = 18 $.
    answer: |
        $ 15 $ способов для слова "редактор" и $ 18 $ для слова "преступление".

@task
    title: Покоритель гор
    statement: |
        На вершину горы ведут шесть маршрутов. Сколькими способами можно подняться на вершину и потом спуститься с нее?
        А если спуститься тем же маршрутом нельзя?
    solution: |
        $6$ маршрутов на вершину горы.
        Вне зависимости от выбранного маршрута далее спутиться можно тоже по одному из $6$ маршрутов.
        По [правилу умножения](^productRule) получаем $6 \cdot 6 = 36$ способов совершить восхождение и спутиться.

        Если же спуститься тем же маршрутом нельзя, то после любого выбранного пути наверх остается только $5$ путей вниз: $6 \cdot 5 = 30$.
    answer: |
        $36$ способов подняться и спуститься. $30$, если использовать один и тот же путь нельзя.

@task
    title: Железный человек
    statement: |
        Перед инженером лежит куча металлолома, состоящего из $21$ трубы и $17$ пластин (все разных размеров).
        Сколькими способами он может выбрать одну трубу и одну пластину?
        Если такой выбор уже сделан, сколько есть способов сделать его еще раз?
    solution: |
        По [правилу умножения](^productRule) имеем $21 \cdot 17 = 357$ способов выбрать трубу и пластину.
        Если такой выбор уже был сделан, то осталось лишь $20$ труб и $16$ пластин, что дает $20 \cdot 16 = 320$ способов.
    answer: |
        $357$ изначальных способов и $320$ способов выбрать еще раз.

@task
    title: Отдай доску!
    statement: |
        Сколькими способами можно выбрать на шахматной доске черное и белое поля, не лежащие на одной горизонтали или одной вертикали?
    hint: |
        Используйте тот факт, что в любой строке и любом столбце шахматной доски есть $4$ черных и $4$ белых поля.
    solution: |
        Всего на доске $32$ черных поля.
        Значит у нас есть $32$ варианта выбрать его.
        После этого строка и столбец, на пересечении которых находится выбранное черное поле, выбывают из рассмотрения.

        { .w3 }
        @image
            src: images/chessboard-black-chosen.svg
        
        В любой строке и любом столбце есть по $4$ белых поля, поэтому после сделанного выбора из $32$ белых полей осталось только $32 - 8 = 24$.
        По [правилу умножения](^productRule) получаем $32 \cdot 24 = 768$ способов выбрать черное и белое поля.
    answer: |
        $ 768 $

@task
    title: Свобода выбора
    statement: |
        В торговом автомате продается $10$ видов газированных напитков и $7$ видов шоколадных батончиков.
        Петя покупает газированный напиток или шоколадный батончик, а Настя берет и напиток, и батончик.
        В каком случае Настя имеет большую свободу выбора: если Петя купил напиток, или если он купил батончик?
    solution: |
        Если Петя купит напиток, то у Насти по правилу умножения у насти есть $9 \cdot 7 = 63$ способа совершить покупку.
        Если же он купит батончик, то у Насти остается всего $10 \cdot 6 = 60$ способов.
        Большая свобода выбора у Насти будет, если Петя купит напиток.
    answer: |
        У Насти будет больше вариантов совершить выбор, если Петя купит напиток.

@task
    title: Ударный отряд
    statement: |
        На сражение против монстров записалось $20$ воинов, $13$ магов, $5$ лучников и $3$ жреца.
        Сколькими способами можно составить ударный отряд из $4$ человек так, чтобы у каждого была своя роль?
    solution: |
        Выбрать воина можно $20$ способами.
        Вне зависимости от сделанного выбора, после этого есть $13$ способов выбрать мага.
        Опять же, вне зависимости от выбранной пары "воин, маг", есть $5$ способов выбрать лучника.
        Так же и со жрецом.

        По [правилу умножения](^productRule) получаем:

        $$ 20 \cdot 13 \cdot 5 \cdot 3 = 3900 $$

        Всего $3900$ способов собрать ударный отряд.
    answer: |
        $3900$

@task
    title: Гроза конспектов
    statement: |
        В магазине канцелярских товаров продается $7$ разных видов синих ручек, $5$ видов черных и $4$ вида красных ручек.
        Кроме того, есть $6$ комплектов из двух ручек: синей и черной и $3$ вида комплектов из черной и красной ручек.
        Сколько есть способов совершить покупку, содержащую по одной ручке каждого цвета?

        А если в этом магазине есть еще $4$ комплекта из синей и красной ручек и $9$ комплектов из трех ручек разных цветов?
    hint: |
        Разбейте все способы совершить покупку на несколько классов, в зависимости от типа покупаемых товаров: только отдельные ручки, отдельная ручка вместе с комплектом и так далее.
    solution: |
        Введем класс $K_1$, в котором будут только покупки отдельных ручек -- без комплектов.
        По [правилу умножения](^productRule) получаем $7 \cdot 5 \cdot 4 = 140$ вариантов совершить покупку.

        В классе $K_2$ рассмотрим покупки комплекта из синей и черной ручек и отдельно красной ручки.
        Всего $6 \cdot 4 = 24$ варианта.

        В классе $K_3$ рассмотрим покупки отдельно синей ручки и комплекта из черной и красной ручек.
        $3 \cdot 7 = 21$ вариант.

        Мы построили классы так, что в них нет одинаковых покупок, поэтому они не пересекаются.
        Поэтому мы можем применить [правило суммы](^sumRule):

        $$ \underbrace{140}_{K_1} + \underbrace{24}_{K_2} + \underbrace{21}_{K_3} = 185 $$

        Если учитывать дополнительные условия, то мы получаем еще два класса: $K_4$ с $4 \cdot 5 = 20$ и $K_5$ с $9$ способами, что суммарно дает $185 + 20 + 9 = 214$ способов совершить покупку.
    answer: |
        $185$ способов совершить покупку.<br>
        $214$ способов, если учитывать дополнительные условия.

@task
    title: Бегай там крутись...
    statement: |
        Имеются три волчка с $6$, $7$ и $9$ гранями соответственно.
        Их одновременно запустили.
        Сколькими различными способами они могут упасть?
        Сколько среди них способов, при которых по крайней мере два волчка упали на сторону, помеченную цифрой $2$?
    hint: |
        Для ответа на второй вопрос разбейте все варианты падения с условием "хотя бы два на грани с цифрой $2$" на классы. Обратите внимание на особый случай, когда все три волчка упали на грань с $2$.
    solution: |
        Падение одного волчка никак не влияет и не зависит от падения двух других, поэтому мы можем использовать [правило произведения](^productRule), согласно которому волчки могут упасть $6 \cdot 7 \cdot 9 = 378$ разными способами.

        Для ответа на второй вопрос поделим все падения на классы.
        В классе $K_{22x}$ будут все падения, при которых первый и второй волчки упали на грань с цифрой $2$, а третий упал на любую грань **кроме** $2$.
        Раз последний волчок может упасть на любую из девяти граней, кроме $2$, то получается у него всего $8$ вариантов упасть, что дает $8$ способов падений волчков в классе $K_{22x}$.

        Аналагично в классе $K_{2x2}$ есть $6$ способов, а в классе $K_{x22}$ есть $5$ способов падений волчков.
        Наконец, есть еще один вариант -- когда все три волчка упадут на грань с цифрой $2$. Этот вариант обозначим классом $K_{222}$.

        Итак, имеем четыре класса, которые состоят из уникальных вариантов падения трех волчков.
        Эти классы не пересекаются, поэтому мы можем применить [правило суммы](^sumRule):

        $$ \underbrace{8}_{K_{22x}} + \underbrace{6}_{K_{2x2}} + \underbrace{5}_{K_{x22}} + \underbrace{1}_{K_{222}} = 20 $$
    answer: |
        Три волчка могут упасть $378$ разными способами, в $20$ из которых по крайней мере два волчка упадут на грань с цифрой $2$.

@task
    title: Тот, кого нельзя называть
    statement: |
        У англичан принято давать ребенку несколько имен.
        Сколькими способами в Англии можно назвать ребенка, если общее число имен равно $300$, а ему дают не более трех имен?
        Хватит ли этих наборов на всех англичан ($57$ млн чел.) или непременно найдутся англичане с одинаковыми именами?
    hint: |
        Разбейте все возможные комбинации имен для англичан на классы по количеству слов.
    solution: |
        Разделим все возможные комбинации имен для англичан на три класса по количеству слов.

        В классе $K_1$ есть $300$ вариантов назвать ребенка одним именем.
        
        В классе $K_2$ для первого имени есть $300$ вариантов.
        Вне зависимости от выбора первого имени, второе всегда можно выбрать $299$ способами (не $300$, так как одно имя уже использовали).
        По [правилу произведения](^productRule) получаем $300 \cdot 299 = 89 \ 700$ вариантов в классе $K_2$.

        В классе $K_3$ при помощи тех же рассуждений получаем:

        $$ 300 \cdot 299 \cdot 298 = 26 \ 730 \ 600 $$

        Итак, имеем три класса с уникальными комбинациями имен.
        Полного совпадения двух имен из разных классов произойти не может, так как в классе $K_1$ имена состоят из одного слова, в $K_2$ из двух, а в $K_3$ из трех.
        Раз пересечений нет, мы можем использовать [правило суммы](^sumRule):

        $$ \underbrace{300}_{K_1} + \underbrace{89 \ 700}_{K_2} + \underbrace{26 \ 730 \ 600}_{K_3} = 26 \ 820 \ 600 $$

        Видно, что англичан гораздо больше, чем имен, поэтому непременно найдутся англичане с одинаковыми именами.
    answer: |
        Всего $26 \ 820 \ 600$ имен. На всех англичан не хватит.

@task
    title: Считатель чисел
    statement: |
        Сколько есть чисел от $0$ до $99 \ 999$, в которых нет двух рядом стоящих одинаковых цифр?
    hint: |
        Разбейте все такие числа на классы по количеству цифр, из которых они состоят.
    solution: |
        Введем классы чисел по количеству цифр, из которых они состоят.

        В классе $K_1$ у нас $10$ чисел -- от $0$ до $9$.

        В классе $K_2$ у нас двузначные числа.
        Первая цифра может быть любой, кроме $0$ (иначе получится однозначное число), то есть $9$ вариантов.
        Вторая цифра тоже может быть любой, кроме той, что стоит на первом месте, поэтому тоже $9$ вариантов.
        По [правилу умножения](^productRule) всего в $K_2$ имеется $9\cdot 9 = 81$ число.

        В классе $K_3$ всего $9\cdot 9 \cdot 9 = 729$ трехзначных чисел.
        Продолжаем все эти рассуждения вплоть до класса $K_5$ -- пятизначных чисел.

        Имеем $5$ классов уникальных чисел, каждое из которых не содержит двух рядом стоящих одинаковых цифр.
        Для подсчета всех таких чисел можно использовать [правило суммы](^sumRule):

        $$ \underbrace{10}_{K_1} + \underbrace{81}_{K_2} + \underbrace{729}_{K_3} + \underbrace{6561}_{K_4} + \underbrace{59 \ 049}_{K_5} = 66 \ 430 $$
    answer: |
        $66 \ 430$ чисел.

@task
    title: Очень послушный робот
    desc: ЕГЭ Информатика
    statement: |
        Артем создал робота, который умеет делать три арифметических действия:

        1. Прибавить $1$
        2. Прибавить $2$
        3. Умножить на $2$

        Сколько различных цепочек команд можно дать роботу, чтобы он из числа $3$ получил число $12$ и чтобы в промежуточных вычислениях обязательно оказалось число $10$?

@task
    title: Диагональный метод
    statement: |
        Сколько диагоналей у шестиугольника?
        А у $n$-угольника?
    hint: |
        Возьмите любую вершину многоугольника и посмотрите, сколько из нее можно провести диагоналей.
        Воспользуйтесь [правилом произведения](^productRule).
    solution: |
        Выберем любую из шести вершин шестиугольника, например $E$.
        Диагональ можно провести к любой из вершин, кроме самой вершины $E$ и двух ее "соседей" $F$ и $D$, потому что к ним идут стороны.
        Остаются только $3$ вершины, к которым можно провести диагонали.

        { .w3 }
        @image
            src: images/diag-example.svg

        Так как подобные рассуждения можно провести с любой из $6$-ти вершин и каждая даст по $3$ диагонали, то всего получаем $18$ диагоналей так?
        Почти, но не совсем.
        Дело в том, что считая таким образом мы получаем дубликат каждой диагонали.

        { .w7 }
        @image
            src: images/diag-duplicate.svg
            caption: Возникновение дубликата диагонали.

        Например, на рисунке изображена диагональ $EB$, причем "отправной" точкой является $E$.
        Но, когда "отправной" точкой станет $B$, мы лишний раз засчитаем точно такую же диагональ $BE$.
        Такой дубликат есть у каждой диагонали, поэтому на самом деле их не $18$, а всего $9$.

        ### Общий случай

        У любого $n$-угольника есть $n$ вершин.
        Возьмем любую такую вершину.
        Мы можем провести диагональ к любой вершине, кроме ее самой и двух соседних, потому что к ним ведут стороны этого $n$-угольника.

        Тогда остается $n-3$ вершин на выбор.
        По [правилу произведения](^productRule) получаем $n\cdot(n-3)$ диагонали.
        Но среди этих диагоналей каждая имеет свой дубликат, поэтому для получения правильного ответа надо разделить результат правила произведения на $2$:

        $$ \frac{n(n-3)}{2} $$
    answer: |
        $9$ диагоналей у шестиугольника.<br>
        Формула для количества диагоналей $n$-угольника:

        $$ \frac{n(n-3)}{2} $$

@task
    title: Латинский квадрат
    desc: Сложная. Исследовательская
    statement: |
        Квадрат разделен на $16$ равных квадратов.
        Сколькими способами можно раскрасить их в белый, черный, красный и синий цвета так, чтобы в каждом горизонтальном и каждом вертикальном ряду были все четыре цвета?
    solution: |
        Найдем количество способов закрасить $4$ квадрата верхней строчки.
        Первое поле можно закрасить одним из $4$-х цветов.
        Вне зависимости от выбранного цвета второе поле можно закрасить $3$-мя способами и так далее.
        По [правилу произведения](^productRule) получается $4 \cdot 3 \cdot 2 \cdot 1 = 24$ варианта раскраски верхней строчки.

        <style>
            .latin-square td { width: 40px; height: 40px; text-align: center; }
        </style>

        { .latin-square }
        @table
            content:
                <tr>
                    <td>$4$</td>
                    <td>$3$</td>
                    <td>$2$</td>
                    <td>$1$</td>
                </tr>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>

        Теперь займемся левым столбцом.
        Вне зависимости от раскраски верхней строчки, вторую ячейку столбца можно закрасить $3$-мя способами, третью $2$-мя и так далее.
        Всего $3 \cdot 2 \cdot 1 = 6$ способов завершить закраску левого столбца при условии, что верхнее его поле уже закрашено.

        { .latin-square }
        @table
            content:
                <tr>
                    <td>$4$</td>
                    <td>$3$</td>
                    <td>$2$</td>
                    <td>$1$</td>
                </tr>
                <tr>
                    <td>$3$</td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>$2$</td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>$1$</td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>

        Получается, любая из $24$ закрасок верхней строки порождает $6$ вариантов закрасить левый столбец.
        По правилу произведения получаем всего $24 \cdot 6 = 144$ разных "уголков" таблицы.

        А дальше начинаются проблемы. По мере закрашивания оставшихся $9$ ячеек количество вариантов закрасить очередную клетку **будет различаться** в зависимости от предыдущих выборов. Из-за этого мы больше [не можем](@article/i:rule-of-product-usage) использовать правило произведения.

        Нужно искать другой путь.        

        ### Каноничный уголок

        Выберем один любой из $144$ уголков таблицы и назовем его "каноничным":

        { .latin-square }
        @table
            content:
                <tr>
                    <td>Б</td>
                    <td>Ч</td>
                    <td>К</td>
                    <td>С</td>
                </tr>
                <tr>
                    <td>Ч</td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>К</td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>С</td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>

        Теперь прямым перебором начнем заполнять пустые ячейки цветами.
        Делать это можно в любом порядке, но мы будем последовательными и возьмемся за вторую строку таблицы.
        Есть только три способа заполнить ее так, чтобы не нарушить условие задачи: БСК, КСБ и СБК.

        Первый вариант порождает два способа завершить закраску квадрата, а второй и третий по одному.
        Всего суммарно получаем $4$ способа закрасить квадрат с каноничным уголком.

        ### Латинский квадрат

        На самом деле эта задача, как и многие другие похожие имеют общее название -- задачи о [латинском квадрате](https://ru.wikipedia.org/wiki/%D0%9B%D0%B0%D1%82%D0%B8%D0%BD%D1%81%D0%BA%D0%B8%D0%B9_%D0%BA%D0%B2%D0%B0%D0%B4%D1%80%D0%B0%D1%82).
        Сам же латинский квадрат -- это квадратная таблица размерами $n \times n$.
        В каждую ячейку этой таблицы ставится один из $n$ уникальных элементов так, чтобы не встречалось одинаковых элементов в любой строке или столбце.
        И совершенно не важно, что это за элементы: цвета (как в этой задаче), буквы, да хоть кролики.

        По сути в этой задаче нас просят найти количество латинских квадратов размера $4$.
        Для продолжения решения нам нужно доказать довольно очевидное утверждение:

        { #latin-square }
        @theorem
            title: Устойчивость латинского квадрата
            statement: |
                Латинский квадрат после перестановки строк или столбцов остается латинским.<br>
                И наоборот, нелатинский квадрат при перестановках так и останется нелатинским.
            proof: |
                Тут доказательство.

        @theorem
            title: Однозначость уголков
            statement: |
                Из двух разных латинских квадратах с одниковым уголком с помощью перестановок нельзя превратить в один латинский квадрат с другим уголком.

        ### Другие уголки

        Итак, мы нашли $4$ латинских квадрата с каноническим уголком.
        Но помимо него у нас есть еще $143$ нерасмотренных уголка.
        Как быть?

        На самом деле, с помощью перестановок можно канонический уголок превратить в любой из $143$ оставшихся!
        Но тогда и $4$ найденных латинских квадрата с каноническим уголком [превратятся](t:latin-square) в еще $4$ других латинских квадрата с выбранным новым уголком!

        А почему они превратятся именно в $4$ квадрата, а не

        Раз из нелатинского квадрата латинский никак не получить, то можно не боятся, что мы пропустим какие-то экзотические раскраски, которые при хитрых перестановках превратятся в латинский квадрат.

        Проблема математики.