<div class="task" id="atask:Latinskii-kvadrat"><header><div class="info"><div class="title">Латинский квадрат</div><div class="desc">Сложная. Исследовательская</div></div><div class="controls"><button data-section="solution" title="Решение"><i></i></button></div></header><div class="statement"><p>Квадрат разделен на <span class="mathInline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>16</mn></mrow><annotation encoding="application/x-tex">16</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">16</span></span></span></span></span> равных квадратов.
Сколькими способами можно раскрасить их в белый, черный, красный и синий цвета так, чтобы в каждом горизонтальном и каждом вертикальном ряду были все четыре цвета?</p></div><section data-name="solution"><div class="inner"><header><i></i><span>Решение</span></header><div class="content"><p>Найдем количество способов закрасить <span class="mathInline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>4</mn></mrow><annotation encoding="application/x-tex">4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">4</span></span></span></span></span> квадрата верхней строчки.
Первое поле можно закрасить одним из <span class="mathInline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>4</mn></mrow><annotation encoding="application/x-tex">4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">4</span></span></span></span></span>-х цветов.
Вне зависимости от выбранного цвета второе поле можно закрасить <span class="mathInline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3</mn></mrow><annotation encoding="application/x-tex">3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">3</span></span></span></span></span>-мя способами и так далее.
По <a href="/combinatorics/rules/product/@article/#d:rule-of-product" data-preview="/site/uniques/@article/combinatorics/rules/product/d_rule-of-product.html">правилу произведения</a> получается <span class="mathInline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>4</mn><mo>⋅</mo><mn>3</mn><mo>⋅</mo><mn>2</mn><mo>⋅</mo><mn>1</mn><mo>=</mo><mn>24</mn></mrow><annotation encoding="application/x-tex">4 \cdot 3 \cdot 2 \cdot 1 = 24</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">4</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">3</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">24</span></span></span></span></span> варианта раскраски верхней строчки.</p><style>
    .latin-square td { width: 40px; height: 40px; text-align: center; }
</style><div class="tableWrapper latin-square"><table><tr><td><span class="mathInline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>4</mn></mrow><annotation encoding="application/x-tex">4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">4</span></span></span></span></span></td><td><span class="mathInline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3</mn></mrow><annotation encoding="application/x-tex">3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">3</span></span></span></span></span></td><td><span class="mathInline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span></span></span></span></span></td><td><span class="mathInline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span></span></td></tr><tr><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td></tr></table></div><p>Теперь займемся левым столбцом.
Вне зависимости от раскраски верхней строчки, вторую ячейку столбца можно закрасить <span class="mathInline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3</mn></mrow><annotation encoding="application/x-tex">3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">3</span></span></span></span></span>-мя способами, третью <span class="mathInline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span></span></span></span></span>-мя и так далее.
Всего <span class="mathInline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3</mn><mo>⋅</mo><mn>2</mn><mo>⋅</mo><mn>1</mn><mo>=</mo><mn>6</mn></mrow><annotation encoding="application/x-tex">3 \cdot 2 \cdot 1 = 6</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">3</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">6</span></span></span></span></span> способов завершить закраску левого столбца при условии, что верхнее его поле уже закрашено.</p><div class="tableWrapper latin-square"><table><tr><td><span class="mathInline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>4</mn></mrow><annotation encoding="application/x-tex">4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">4</span></span></span></span></span></td><td><span class="mathInline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3</mn></mrow><annotation encoding="application/x-tex">3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">3</span></span></span></span></span></td><td><span class="mathInline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span></span></span></span></span></td><td><span class="mathInline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span></span></td></tr><tr><td><span class="mathInline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3</mn></mrow><annotation encoding="application/x-tex">3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">3</span></span></span></span></span></td><td></td><td></td><td></td></tr><tr><td><span class="mathInline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span></span></span></span></span></td><td></td><td></td><td></td></tr><tr><td><span class="mathInline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span></span></td><td></td><td></td><td></td></tr></table></div><p>Получается, любая из <span class="mathInline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>24</mn></mrow><annotation encoding="application/x-tex">24</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">24</span></span></span></span></span> закрасок верхней строки порождает <span class="mathInline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>6</mn></mrow><annotation encoding="application/x-tex">6</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">6</span></span></span></span></span> вариантов закрасить левый столбец.
По правилу произведения получаем всего <span class="mathInline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>24</mn><mo>⋅</mo><mn>6</mn><mo>=</mo><mn>144</mn></mrow><annotation encoding="application/x-tex">24 \cdot 6 = 144</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">24</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">6</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">144</span></span></span></span></span> разных «уголков» таблицы.</p><p>А дальше начинаются проблемы. По мере закрашивания оставшихся <span class="mathInline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>9</mn></mrow><annotation encoding="application/x-tex">9</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">9</span></span></span></span></span> ячеек количество вариантов закрасить очередную клетку <strong>будет различаться</strong> в зависимости от предыдущих выборов. Из-за этого мы больше <a href="/combinatorics/rules/product/@article/#i:rule-of-product-usage" data-preview="/site/uniques/@article/combinatorics/rules/product/i_rule-of-product-usage.html">не можем</a> использовать правило произведения.</p><p>Нужно искать другой путь.        </p><h3 id="ah:Kanonichnii-ugolok">Каноничный уголок<a class="hAnchor" href="#ah:Kanonichnii-ugolok"><i class="i-link"></i></a></h3><p>Выберем один любой из <span class="mathInline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>144</mn></mrow><annotation encoding="application/x-tex">144</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">144</span></span></span></span></span> уголков таблицы и назовем его «каноничным»:</p><div class="tableWrapper latin-square"><table><tr><td>Б</td><td>Ч</td><td>К</td><td>С</td></tr><tr><td>Ч</td><td></td><td></td><td></td></tr><tr><td>К</td><td></td><td></td><td></td></tr><tr><td>С</td><td></td><td></td><td></td></tr></table></div><p>Теперь прямым перебором начнем заполнять пустые ячейки цветами.
Делать это можно в любом порядке, но мы будем последовательными и возьмемся за вторую строку таблицы.
Есть только три способа заполнить ее так, чтобы не нарушить условие задачи: БСК, КСБ и СБК.</p><p>Первый вариант порождает два способа завершить закраску квадрата, а второй и третий по одному.
Всего суммарно получаем <span class="mathInline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>4</mn></mrow><annotation encoding="application/x-tex">4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">4</span></span></span></span></span> способа закрасить квадрат с каноничным уголком.</p><h3 id="ah:Latinskii-kvadrat">Латинский квадрат<a class="hAnchor" href="#ah:Latinskii-kvadrat"><i class="i-link"></i></a></h3><p>На самом деле эта задача, как и многие другие похожие имеют общее название — задачи о <a href="https://ru.wikipedia.org/wiki/%D0%9B%D0%B0%D1%82%D0%B8%D0%BD%D1%81%D0%BA%D0%B8%D0%B9_%D0%BA%D0%B2%D0%B0%D0%B4%D1%80%D0%B0%D1%82">латинском квадрате</a>.
Сам же латинский квадрат — это квадратная таблица размерами <span class="mathInline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>×</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">n \times n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span></span>.
В каждую ячейку этой таблицы ставится один из <span class="mathInline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span></span> уникальных элементов так, чтобы не встречалось одинаковых элементов в любой строке или столбце.
И совершенно не важно, что это за элементы: цвета (как в этой задаче), буквы, да хоть кролики.</p><p>По сути в этой задаче нас просят найти количество латинских квадратов размера <span class="mathInline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>4</mn></mrow><annotation encoding="application/x-tex">4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">4</span></span></span></span></span>.
Для продолжения решения нам нужно доказать довольно очевидное утверждение:</p><div class="accentBlock" id="t:latin-square" data-type="theorem"><div class="side"><div class="type" title="Утверждение"><i></i></div><div class="expand" title="Доказательство"><div class="bgOverlay"></div><i class="i-chevron-up"></i></div></div><div class="content"><div class="primaryWrapper"><div class="title">Устойчивость латинского квадрата</div><div class="main"><p>Латинский квадрат после перестановки строк или столбцов остается латинским.<br>
И наоборот, нелатинский квадрат при перестановках так и останется нелатинским.</p></div></div><div class="expand"><section><div class="title">Доказательство</div><div class="content"><p>Тут доказательство.</p></div></section></div></div></div><div class="accentBlock" data-type="theorem"><div class="side"><div class="type" title="Утверждение"><i></i></div></div><div class="content"><div class="primaryWrapper"><div class="title">Однозначость уголков</div><div class="main"><p>Из двух разных латинских квадратах с одниковым уголком с помощью перестановок нельзя превратить в один латинский квадрат с другим уголком.</p></div></div></div></div><h3 id="ah:Drugie-ugolki">Другие уголки<a class="hAnchor" href="#ah:Drugie-ugolki"><i class="i-link"></i></a></h3><p>Итак, мы нашли <span class="mathInline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>4</mn></mrow><annotation encoding="application/x-tex">4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">4</span></span></span></span></span> латинских квадрата с каноническим уголком.
Но помимо него у нас есть еще <span class="mathInline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>143</mn></mrow><annotation encoding="application/x-tex">143</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">143</span></span></span></span></span> нерасмотренных уголка.
Как быть?</p><p>На самом деле, с помощью перестановок можно канонический уголок превратить в любой из <span class="mathInline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>143</mn></mrow><annotation encoding="application/x-tex">143</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">143</span></span></span></span></span> оставшихся!
Но тогда и <span class="mathInline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>4</mn></mrow><annotation encoding="application/x-tex">4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">4</span></span></span></span></span> найденных латинских квадрата с каноническим уголком <a href="/combinatorics/rules/product/@practicum/#t:latin-square" data-preview="/site/uniques/@practicum/combinatorics/rules/product/t_latin-square.html">превратятся</a> в еще <span class="mathInline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>4</mn></mrow><annotation encoding="application/x-tex">4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">4</span></span></span></span></span> других латинских квадрата с выбранным новым уголком!</p><p>А почему они превратятся именно в <span class="mathInline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>4</mn></mrow><annotation encoding="application/x-tex">4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">4</span></span></span></span></span> квадрата, а не</p><p>Раз из нелатинского квадрата латинский никак не получить, то можно не боятся, что мы пропустим какие-то экзотические раскраски, которые при хитрых перестановках превратятся в латинский квадрат.</p><p>Проблема математики.</p></div></div></section></div>