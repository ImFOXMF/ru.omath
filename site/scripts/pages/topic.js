(()=>{var y=Object.defineProperty;var M=(i,e,t)=>e in i?y(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var T=(i,e,t)=>(M(i,typeof e!="symbol"?e+"":e,t),t);var l=class{preview;asideToggler;static get(){return window.OMath}};function b(){window.location.hash&&S(window.location.hash.slice(1)),window.addEventListener("hashchange",()=>{let i=window.location.hash;S(i.slice(1))})}function S(i){if(document.documentElement.getAttribute("data-layout")!=="topic")return;let e=document.getElementById(i);if(!e)return;let t=e;for(;(t=t.parentElement)!==null;){if(t.classList.contains("accentBlock")){let s=t.querySelector(":scope > .base > .expand");s&&s.contains(e)&&t.setAttribute("data-expand-open","")}t.classList.contains("task")&&t.querySelectorAll(":scope > section").forEach(n=>{n.contains(e)&&t.setAttribute(`data-${n.getAttribute("data-name")}-open`,"")})}let r=document.createElement("a");r.href="#"+i,r.click()}var u=class{updateAllowed=!0;updateDelay=150;idToHeader={};idToElem={};idToTocElem={};constructor(e){this.fillMaps(e);let t;["resize","scroll"].forEach(r=>{window.addEventListener(r,()=>{clearTimeout(t),t=setTimeout(()=>{this.updateTocPos()},this.updateDelay)})}),window.addEventListener("hashchange",()=>{this.updateTocPos()}),this.setupForcedToc(),this.updateTocPos()}fillMaps(e){for(e of e.children){let t=e.querySelector(":scope > a").getAttribute("href").slice(1),r=["heading","auto-heading"].includes(t.split(":")[0]);this.idToTocElem[t]=e;let s=document.getElementById(t);r?this.idToHeader[t]=s:this.idToElem[t]=s}}setupForcedToc(){let e;Object.keys(this.idToTocElem).forEach(t=>{this.idToTocElem[t].addEventListener("click",()=>{clearTimeout(e),e=setTimeout(()=>{this.updateAllowed=!0},this.updateDelay+100),this.updateAllowed=!1,this.clearCurrentPos(),this.setCurrentPos(t)})})}updateTocPos(){if(!this.updateAllowed||(this.clearCurrentPos(),!this.hasVScrollbar()))return;let e=Object.values(this.idToHeader);if(e.length){let r=this.getCurrentHeaderIdFrom(e);this.setCurrentPos(r)}let t=Object.values(this.idToElem);if(t.length){let r=this.getCurrentElementIdFrom(t);r&&this.setCurrentPos(r)}}getCurrentHeaderIdFrom(e){let t=window.scrollY+300,r=0,s=e.length,n=0;for(;r<s;){let o=(r+s)/2|0,d=e[o].getBoundingClientRect().top+window.scrollY;t<=d?s=o:(n=o,r=o+1)}return e[n].id}getCurrentElementIdFrom(e){let t=0,r=e.length,s=null,n=-1;for(;t<r;){let o=(t+r)/2|0,m=e[o],d=m.getBoundingClientRect(),v=d.top,E=d.bottom;if(E<0){t=o+1;continue}if(v>document.documentElement.clientHeight){r=o;continue}let p=E-300;(Math.abs(p)<n||n===-1)&&(n=Math.abs(p),s=m),p<0?t=o+1:r=o}return s?s.id:null}setCurrentPos(e){this.idToTocElem[e].setAttribute("data-current","")}clearCurrentPos(){Object.values(this.idToTocElem).forEach(e=>e.removeAttribute("data-current"))}hasVScrollbar(){return window.innerWidth>document.documentElement.clientWidth}};var g=class{element;messageElem;messages;messageI=0;constructor(e,t){this.messages=e.messages,h(this.messages);let r=document.createElement("div");r.innerHTML=c.renderSponsor(e),this.element=r.firstChild,this.messageElem=this.element.querySelector(".message"),this.updateMessage(),this.element.querySelector(".actions .next").addEventListener("click",()=>t.next()),t.inner.appendChild(this.element),t.sponsorMap[e.id]=this}updateMessage(){this.messageElem.textContent=this.messages[this.messageI++%this.messages.length]}toggleCurrentClass(e){this.element.classList.toggle("current",e)}},w=class{root;inner;sponsorMap={};tier;currentSponsor;currentI=0;fakeI;resizeObs;constructor(e,t){this.tier=t,this.fakeI=w.fakeStartIndex++,this.root=e,this.inner=document.createElement("div"),this.inner.classList.add("inner"),this.root.appendChild(this.inner),this.resizeObs=new ResizeObserver(()=>this.onResize()),this.next()}getRaw(){let e=c[`tier${this.tier}`],t=e[this.currentI%e.length];return t==="fake"?this.getFakeRaw():t}getFakeRaw(){let e={...c.fakeSponsors[this.fakeI%c.fakeSponsors.length]};return e.isFake=!0,e.tier=this.tier,this.tier===3&&(e.id+="-tier3"),this.tier<3&&delete e.avatarVideo,e}next(){let e=this.getRaw();this.currentI++,e.isFake&&this.fakeI++;let t=this.getRaw();[e,t].forEach(s=>{s.id in this.sponsorMap||new g(s,this)});let r=this.sponsorMap[e.id];this.setCurrentSponsor(r)}setCurrentSponsor(e){this.currentSponsor&&(this.resizeObs.unobserve(this.currentSponsor.element),this.currentSponsor.toggleCurrentClass(!1)),this.currentSponsor=e,this.currentSponsor.updateMessage(),this.currentSponsor.toggleCurrentClass(!0),this.resizeObs.observe(this.currentSponsor.element),this.onResize()}onResize(){let e=this.currentSponsor.element.getBoundingClientRect().height;this.root.setAttribute("style",`height: ${e}px`)}},a=w;T(a,"fakeStartIndex",0);var f=class{renderSponsor;fakeSponsors;tier3;tier2},c;async function k(){let i=await fetch("/site/topicSponsorData.json");if(!i.ok)return!1;let e=await i.json(),t=new f;return t.renderSponsor=new Function("locals",e.templateFuncStr+" return template(locals);"),t.fakeSponsors=e.fakeSponsors,t.tier3=e.sponsors.tier3,t.tier2=e.sponsors.tier2,h(t.fakeSponsors),h(t.tier2),h(t.tier3),t.tier3.push("fake"),t.tier2.push("fake"),c=t,!0}function h(i){for(let e=i.length-1;e>0;e--){let t=Math.floor(Math.random()*(e+1));[i[e],i[t]]=[i[t],i[e]]}}window.addEventListener("DOMContentLoaded",()=>{x()});window.addEventListener("load",()=>{let i=l.get().asideToggler;i.asides.minor.querySelector(":scope > .mini > a[data-current]").addEventListener("click",()=>{i.toggleAside(i.asides.minor,!0)}),A(),L(),window.location.hash.startsWith("#todo:")&&C(),b(),new u(i.asides.minor.querySelector(":scope > .full .topicToc .tocTree"))});function A(){let i=l.get().asideToggler.asides.minor,e=i.querySelector(":scope > .full > .contributors"),t=i.querySelector(":scope > .full > .minorView.contribution"),r=t.querySelector(":scope .close");[e,r].forEach(s=>{s.addEventListener("click",()=>t.toggleAttribute("data-visible"))})}function L(){let i=l.get().asideToggler.asides.minor,e=i.querySelector(":scope > .full > .editorSwitch"),t=i.querySelector(":scope > .full > .minorView.todo");if(!t)return;let r=t.querySelector(":scope .close");[e,r].forEach(s=>{s.addEventListener("click",()=>C())})}function x(){let i=document.getElementById("sponsorBlockTier3"),e=document.getElementById("sponsorBlockTier2");k().then(t=>{if(!t){[i,e].forEach(r=>r.remove());return}new a(i,3),new a(e,2)})}function C(){document.documentElement.classList.toggle("displayTodo"),l.get().asideToggler.asides.minor.querySelector(":scope > .full > .minorView.todo").toggleAttribute("data-visible")}})();
